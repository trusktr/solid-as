<!DOCTYPE html>
<html lang="en">
	<head>
		<script type="module">
			// Original example uses auto-generated bindings with no way to control Wasm imports
			// import { add } from "./dist/release.js";
			// document.body.innerText = add(1, 2);

			import {ECMAssembly} from './node_modules/ecmassembly/index.js'
			import ASLoader from './node_modules/@assemblyscript/loader/index.js'

			const es = new ECMAssembly()
			let wasmModule

			const imports = {
				...es.wasmImports,

				/*...All your own imports...*/
				console: {
					log: s => console.log(wasmModule.exports.__getString(s)),
				},
			}

			ASLoader.instantiateStreaming(fetch('./dist/release.wasm'), imports).then(_wasmModule => {
				wasmModule = _wasmModule

				// After the Wasm module is created, you need to pass the exports back to the lib:
				es.wasmExports = wasmModule.exports

				// Then finally, run anything from the module that depends on setTimeout, Promise, etc:
				wasmModule.exports.test()
			})
		</script>
	</head>
	<body></body>
</html>
